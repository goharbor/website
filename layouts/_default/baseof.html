<!-- This is the complete and correct final code for layouts/_default/baseof.html -->

{{ $lang := site.LanguageCode }}
{{ $home := .IsHome }}
<!DOCTYPE html>
<html{{ with $lang }} lang="{{ . }}"{{ end }}>
  <head>
    {{ partial "meta.html" . }}
    <title>
      {{ block "title" . }}
      {{ site.Title }}
      {{ end }}
    </title>
    {{ partial "css.html" . }}
    {{ partial "favicon.html" . }}

    {{ if $home }}
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    {{ end }}
    <!-- Analytics -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TKWH5SPC');</script>
    <!-- End Analytics -->

    <!-- =================================================================== -->
    <!-- START: Your Canonical URL Addition -->
    <!-- =================================================================== -->
    {{ $isVersioned := "" }}
    {{ with (findRE `^/docs/([0-9]+\.[0-9]+)/` .RelPermalink) }}
      {{ $isVersioned = . }}
    {{ end }}
    {{ if $isVersioned }}
      {{ $currentVersionRaw := index (findRE `([0-9]+\.[0-9]+)` .RelPermalink) 0 }}
      {{ $latestVersionWithV := .Site.Params.latest_version }}
      {{/* For the canonical URL, we always point to 'main' */}}
      {{ $canonicalURL := replace .RelPermalink $currentVersionRaw "main" }}
      <link rel="canonical" href="{{ $canonicalURL | absURL }}">
    {{ else }}
      <link rel="canonical" href="{{ .Permalink }}">
    {{ end }}
    <!-- =================================================================== -->
    <!-- END: Your Canonical URL Addition -->
    <!-- =================================================================== -->

  </head>
  <body class="is-page has-navbar-fixed-top">
    <!-- Analytics if (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TKWH5SPC"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- Analytics if  (noscript) -->
    <main class="is-main">
      {{ partial "navbar.html" . }}

      <!-- =================================================================== -->
      <!-- START: Your Version Banner Addition -->
      <!-- =================================================================== -->
      {{ partial "version-banner.html" . }}
      <!-- =================================================================== -->
      <!-- END: Your Version Banner Addition -->
      <!-- =================================================================== -->

      {{ block "main" . }}
      {{ end }}
    </main>

    {{ partial "footer.html" . }}
    {{ partial "javascript.html" }}
  </body>
</html>